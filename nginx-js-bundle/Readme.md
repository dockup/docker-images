# How to use this image

Whenever js files are compiled using webpack, we can use this image to serve
all compiled files using nginx. Also this image will replace url for any
api interaction with dynamic url generated by Dockup


### Create a Dockerfile for compiling js files

```
FROM node:10.15.0

RUN mkdir /app
WORKDIR /app

COPY package*.json ./
RUN npm install

COPY . .

RUN npm run build
```


The above Dockerfile is a sample file which will compile any webpack based
repository into bundle files. We can enable multi step build to copy all
the files to custom nginx image that we've created.


```
FROM node:10.15.0 AS build

RUN mkdir /app
WORKDIR /app

COPY package*.json ./
RUN npm install

COPY . .

RUN npm run build


# 2nd step of build
FROM getdockup/ngnix-js-bundle:1.0

COPY --from=build /app/build /usr/share/nginx/html
```


Resulting image will serve `index.html` for all paths, along with js
files.


### Running generated docker images

The docker images generated can be run with simple `docker run` command.
However, while running these images as part of Dockup, we can define 2
environment variables to change base url given to webpack during compile
time.


`BUILD_API_URL`: Url which is specified to npm build, which will be
                 hard-coded into bundled files

`DOCKUP_API_URL`: Dynamic url generated by dockup which should replace
                  url hard-coded in bundled files.


Once these 2 env vars are defined, this custom nginx image will replace
all bundled js file with dynamic url generated by Dockup.
